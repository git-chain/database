!function(){function v(e,t){return t?require(e):e.slice?v[n(e)]:function(t,r){e(t={exports:{}}),v[n(r)]=t.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}var c;"undefined"!=typeof module&&(c=module),v(function(t){"undefined"!=typeof window&&(t.window=window);var r=(t.window||t).Encryption||{};(r.window=t.window)&&(r.window.Encryption=r);try{void 0+""!=typeof c&&(c.exports=r)}catch(t){}t.exports=r})(v,"./root"),v(function(t){var r=v("./root");try{r.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(location.protocol="https:")}catch(t){}})(v,"./https"),v(function(t){var r;if(r+""==typeof btoa){if(r+""==typeof Buffer)try{global.Buffer=v("buffer",1).Buffer}catch(t){}global.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},global.atob=function(t){return Buffer.from(t,"base64").toString("binary")}}})(v,"./base64"),v(function(t){function r(){}v("./base64"),Object.assign(r,{from:Array.from}),(r.prototype=Object.create(Array.prototype)).toString=function(t,e,r){e=e||0;var n=this.length;if("hex"!==(t=t||"utf8"))return"utf8"===t?Array.from({length:(r||n)-e},(t,r)=>String.fromCharCode(this[r+e])).join(""):"base64"===t?btoa(this):void 0;{const a=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map(t=>a[t+e].toString(16).padStart(2,"0")).join("")}},t.exports=r})(v,"./array"),v(function(t){v("./base64");var s=v("./array");function r(...t){return r.from(...t)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const e=arguments[0];let t;if("string"==typeof e){var r=arguments[1]||"utf8";if("hex"===r){var n=e.match(/([\da-fA-F]{2})/g).map(t=>parseInt(t,16));if(!n||!n.length)throw new TypeError("Invalid first argument for type 'hex'.");t=s.from(n)}else if("utf8"===r||"binary"===r){const a=e.length,o=new Uint16Array(a);Array.from({length:a},(t,r)=>o[r]=e.charCodeAt(r)),t=s.from(o)}else if("base64"===r){const i=atob(e),a=i.length,c=new Uint8Array(a);Array.from({length:a},(t,r)=>c[r]=i.charCodeAt(r)),t=s.from(c)}else"binary"===r?t=s.from(e):console.info("Unknown encoding: "+r);return t}e.byteLength;const a=e.byteLength||e.length;if(a){let t;return e instanceof ArrayBuffer&&(t=new Uint8Array(e)),s.from(t||e)}},alloc(t,r=0){return s.from(new Uint8Array(Array.from({length:t},()=>r)))},allocUnsafe(t){return s.from(new Uint8Array(Array.from({length:t})))},concat(t){if(!Array.isArray(t))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return s.from(t.reduce((t,r)=>t.concat(Array.from(r)),[]))}}),r.prototype.from=r.from,r.prototype.toString=s.prototype.toString,t.exports=r})(v,"./buffer"),v(function(t){var r=v("./root");const e={Buffer:v("./buffer")};var n={};if(JSON.parseAsync=JSON.parseAsync||function(t,r,e){try{r(void 0,JSON.parse(t,e))}catch(t){r(t)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,r,e,n){try{r(void 0,JSON.stringify(t,e,n))}catch(t){r(t)}},e.parse=function(t,r){return new Promise(function(e,n){JSON.parseAsync(t,function(t,r){t?n(t):e(r)},r)})},e.stringify=function(t,r,a){return new Promise(function(e,n){JSON.stringifyAsync(t,function(t,r){t?n(t):e(r)},r,a)})},r.window&&(e.crypto=window.crypto||window.msCrypto,e.subtle=(e.crypto||n).subtle||(e.crypto||n).webkitSubtle,e.TextEncoder=window.TextEncoder,e.TextDecoder=window.TextDecoder,e.random=t=>e.Buffer.from(e.crypto.getRandomValues(new Uint8Array(e.Buffer.alloc(t))))),e.TextDecoder||({TextEncoder:r,TextDecoder:n}=v((void 0+""==typeof c?".":"")+"./lib/text-encoding",1),e.TextDecoder=n,e.TextEncoder=r),!e.crypto)try{var a=v("crypto",1);Object.assign(e,{crypto:a,random:t=>e.Buffer.from(a.randomBytes(t))});const o=v("@peculiar/webcrypto",1)["Crypto"];e.ossl=e.subtle=new o({directory:"ossl"}).subtle}catch(t){}t.exports=e})(v,"./shim"),v(function(t){var r=v("./root"),e=v("./shim"),n={pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(t,r){t={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return t.key_ops=r?["sign"]:["verify"],r&&(t.d=r),t},keyToJwk:function(t){const r=t.toString("base64");return{kty:"oct",k:r.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(t){return t}},check:function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},parse:async function(t){try{var r="string"==typeof t;return r&&"SEA{"===t.slice(0,4)&&(t=t.slice(3)),r?await e.parse(t):t}catch(t){}return t}};r.opt=n,t.exports=n})(v,"./settings"),v(function(t){var e=v("./shim");t.exports=async function(t,r){t="string"==typeof t?t:await e.stringify(t),t=await e.subtle.digest({name:r||"SHA-256"},(new e.TextEncoder).encode(t));return e.Buffer.from(t)}})(v,"./sha256"),v(function(t){var r=v("./shim"),e=r.subtle;const n=r.ossl||e;t.exports=t=>n.digest({name:"SHA-1"},new ArrayBuffer(t))})(v,"./sha1"),v(function(t){var u=v("./root"),f=v("./shim"),p=v("./settings"),y=v("./sha256");u.work=u.work||(async(t,r,e,n)=>{try{var a=(r||{}).epub||r;if(n=n||{},a instanceof Function&&(e=a,a=void 0),t="string"==typeof t?t:await f.stringify(t),"sha"===(n.name||"").toLowerCase().slice(0,3)){var o=f.Buffer.from(await y(t,n.name),"binary").toString(n.encode||"base64");if(e)try{e(o)}catch(t){console.log(t)}return o}var a=a||f.random(9),i=await(f.ossl||f.subtle).importKey("raw",(new f.TextEncoder).encode(t),{name:n.name||"PBKDF2"},!1,["deriveBits"]),c=await(f.ossl||f.subtle).deriveBits({name:n.name||"PBKDF2",iterations:n.iterations||p.pbkdf2.iter,salt:(new f.TextEncoder).encode(n.salt||a),hash:n.hash||p.pbkdf2.hash},i,n.length||8*p.pbkdf2.ks);t=f.random(t.length);var s=f.Buffer.from(c,"binary").toString(n.encode||"base64");if(e)try{e(s)}catch(t){console.log(t)}return s}catch(t){if(console.log(t),u.err=t,u.throw)throw t;return void(e&&e())}}),t.exports=u.work})(v,"./work"),v(function(t){var i=v("./root"),c=v("./shim");v("./settings");i.name=i.name||(async(r,t)=>{try{if(r)try{r()}catch(t){console.log(t)}return}catch(t){if(console.log(t),i.err=t,i.throw)throw t;return void(r&&r())}}),i.pair=i.pair||(async(r,t)=>{try{var e=c.ossl||c.subtle,n=await c.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async t=>{var r={};r.priv=(await c.subtle.exportKey("jwk",t.privateKey)).d;t=await c.subtle.exportKey("jwk",t.publicKey);return r.pub=t.x+"."+t.y,r});try{var a=await e.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async t=>{var r={};r.epriv=(await e.exportKey("jwk",t.privateKey)).d;t=await e.exportKey("jwk",t.publicKey);return r.epub=t.x+"."+t.y,r})}catch(t){if(i.window)throw t;if("Error: ECDH is not a supported algorithm"!=t)throw t;console.log("Ignoring ECDH...")}var a=a||{},o={pub:n.pub,priv:n.priv,epub:a.epub,epriv:a.epriv};if(r)try{r(o)}catch(t){console.log(t)}return o}catch(t){if(console.log(t),i.err=t,i.throw)throw t;return void(r&&r())}}),t.exports=i.pair})(v,"./pair"),v(function(t){var y=v("./root"),l=v("./shim"),h=v("./settings"),w=v("./sha256");y.sign=y.sign||(async(t,r,e,n)=>{try{if(n=n||{},!(r||n).priv){if(!y.I)throw"No signing key";r=await y.I(null,{what:t,how:"sign",why:n.why})}if(void 0===t)throw"`undefined` not allowed";var a=await h.parse(t),o=n.check=n.check||a;if(y.verify&&(y.opt.check(o)||o&&o.s&&o.m)&&void 0!==await y.verify(o,r)){var i=await h.parse(o);if(n.raw||(i="SEA"+await l.stringify(i)),e)try{e(i)}catch(t){console.log(t)}return i}var c=r.pub,s=r.priv,u=h.jwk(c,s),f=await w(a),p=await(l.ossl||l.subtle).importKey("jwk",u,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(t=>(l.ossl||l.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(f))),i={m:a,s:l.Buffer.from(p,"binary").toString(n.encode||"base64")};if(n.raw||(i="SEA"+await l.stringify(i)),e)try{e(i)}catch(t){console.log(t)}return i}catch(t){if(console.log(t),y.err=t,y.throw)throw t;return void(e&&e())}}),t.exports=y.sign})(v,"./sign"),v(function(t){var l=v("./root"),h=v("./shim"),w=v("./settings"),g=v("./sha256");l.verify=l.verify||(async(r,e,n,a)=>{try{var t=await w.parse(r);if(!1===e){var o=await w.parse(t.m);if(n)try{n(o)}catch(t){console.log(t)}return o}a=a||{};var i,c,s,u=e.pub||e,f=l.opt.slow_leak?await l.opt.slow_leak(u):await(h.ossl||h.subtle).importKey("jwk",w.jwk(u),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),p=await g(t.m);try{if(i=h.Buffer.from(t.s,a.encode||"base64"),c=new Uint8Array(i),!(s=await(h.ossl||h.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},f,c,new Uint8Array(p))))throw"Signature did not match"}catch(t){if(l.opt.fallback)return l.opt.fall_verify(r,e,n,a)}var y=s?await w.parse(t.m):void 0;if(n)try{n(y)}catch(t){console.log(t)}return y}catch(t){if(console.log(t),l.err=t,l.throw)throw t;return void(n&&n())}}),t.exports=l.verify;var e={},f=(l.opt.slow_leak=t=>{if(e[t])return e[t];var r=w.jwk(t);return e[t]=(h.ossl||h.subtle).importKey("jwk",r,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),e[t]},l.opt);l.opt.fall_verify=async function(t,r,e,n,a){if(a===l.opt.fallback)throw"Signature did not match";a=a||1;var o=t||"";t=l.opt.unpack(t)||t;var i,c,s,u=await w.parse(t),r=r.pub||r,r=await l.opt.slow_leak(r),a=a<=l.opt.fallback?h.Buffer.from(await h.subtle.digest({name:"SHA-256"},(new h.TextEncoder).encode(await w.parse(u.m)))):await g(u.m);try{if(i=h.Buffer.from(u.s,n.encode||"base64"),c=new Uint8Array(i),!(s=await(h.ossl||h.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},r,c,new Uint8Array(a))))throw"Signature did not match"}catch(t){try{i=h.Buffer.from(u.s,"utf8"),c=new Uint8Array(i),s=await(h.ossl||h.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},r,c,new Uint8Array(a))}catch(t){if(!s)throw"Signature did not match"}}u=s?await w.parse(u.m):void 0;if(f.fall_soul=o["#"],f.fall_key=o["."],f.fall_val=t,f.fall_state=o[">"],e)try{e(u)}catch(t){console.log(t)}return u},l.opt.fallback=2})(v,"./verify"),v(function(t){var n=v("./shim"),a=v("./settings"),o=v("./sha256");t.exports=async(t,r,e)=>{r=t+(r||n.random(8)).toString("utf8"),r=n.Buffer.from(await o(r),"binary"),r=a.keyToJwk(r);return n.subtle.importKey("jwk",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])}})(v,"./aeskey"),v(function(t){var u=v("./root"),f=v("./shim"),p=(v("./settings"),v("./aeskey"));u.encrypt=u.encrypt||(async(t,r,e,n)=>{try{n=n||{};var a=(r||n).epriv||r;if(void 0===t)throw"`undefined` not allowed";if(!a){if(!u.I)throw"No encryption key";a=(r=await u.I(null,{what:t,how:"encrypt",why:n.why})).epriv||r}var o="string"==typeof t?t:await f.stringify(t),i={s:f.random(9),iv:f.random(15)},c=await p(a,i.s,n).then(t=>f.subtle.encrypt({name:n.name||"AES-GCM",iv:new Uint8Array(i.iv)},t,(new f.TextEncoder).encode(o))),s={ct:f.Buffer.from(c,"binary").toString(n.encode||"base64"),iv:i.iv.toString(n.encode||"base64"),s:i.s.toString(n.encode||"base64")};if(n.raw||(s="SEA"+await f.stringify(s)),e)try{e(s)}catch(t){console.log(t)}return s}catch(t){if(console.log(t),u.err=t,u.throw)throw t;return void(e&&e())}}),t.exports=u.encrypt})(v,"./encrypt"),v(function(t){var p=v("./root"),y=v("./shim"),l=v("./settings"),h=v("./aeskey");p.decrypt=p.decrypt||(async(r,e,n,a)=>{try{a=a||{};var t=(e||a).epriv||e;if(!t){if(!p.I)throw"No decryption key.";t=(e=await p.I(null,{what:r,how:"decrypt",why:a.why})).epriv||e}var o=await l.parse(r);try{var i=y.Buffer.from(o.s,a.encode||"base64"),c=y.Buffer.from(o.iv,a.encode||"base64"),s=y.Buffer.from(o.ct,a.encode||"base64"),u=await h(t,i,a).then(t=>y.subtle.decrypt({name:a.name||"AES-GCM",iv:new Uint8Array(c),tagLength:128},t,new Uint8Array(s)))}catch(t){if("utf8"===a.encode)throw"Could not decrypt";if(p.opt.fallback)return a.encode="utf8",p.decrypt(r,e,n,a)}var f=await l.parse(new y.TextDecoder("utf8").decode(u));if(n)try{n(f)}catch(t){console.log(t)}return f}catch(t){if(console.log(t),p.err=t,p.throw)throw t;return void(n&&n())}}),t.exports=p.decrypt})(v,"./decrypt"),v(function(t){var y=v("./root"),l=v("./shim");v("./settings");y.secret=y.secret||(async(t,r,e,n)=>{try{if(n=n||{},!r||!r.epriv||!r.epub){if(!y.I)throw"No secret mix";r=await y.I(null,{what:t,how:"secret",why:n.why})}var a=t.epub||t,o=r.epub,i=r.epriv,c=l.ossl||l.subtle,s=h(a),u=Object.assign({public:await c.importKey(...s,!0,[])},{name:"ECDH",namedCurve:"P-256"}),f=h(o,i),p=await c.importKey(...f,!1,["deriveBits"]).then(async t=>{t=await c.deriveBits(u,t,256),t=new Uint8Array(t),t=await c.importKey("raw",t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return c.exportKey("jwk",t).then(({k:t})=>t)});if(e)try{e(p)}catch(t){console.log(t)}return p}catch(t){if(console.log(t),y.err=t,y.throw)throw t;return void(e&&e())}});var h=(t,r)=>{var[e,t]=t.split(".");return["jwk",Object.assign(r?{d:r}:{},{x:e,y:t,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};t.exports=y.secret})(v,"./secret"),v(function(t){var l=v("./root");l.certify=l.certify||(async(t,r={},e,n,a={})=>{try{if(!(t=(()=>{var r=[];if(t){if(("string"==typeof t||Array.isArray(t))&&-1<t.indexOf("*"))return"*";if("string"==typeof t)return t;if(Array.isArray(t)){if(1===t.length&&t[0])return"object"==typeof t[0]&&t[0].pub?t[0].pub:"string"==typeof t[0]?t[0]:null;t.map(t=>{"string"==typeof t?r.push(t):"object"==typeof t&&t.pub&&r.push(t.pub)})}return"object"==typeof t&&t.pub?t.pub:0<r.length?r:null}})()))return console.log("No certificant found");var o=!a.expiry||"number"!=typeof a.expiry&&"string"!=typeof a.expiry?null:parseFloat(a.expiry),i=(r||{}).read?r.read:null,c=(r||{}).write?r.write:"string"==typeof r||Array.isArray(r)||r["+"]||r["#"]||r["."]||r["="]||r["*"]||r[">"]||r["<"]?r:null,s=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},u=s.read&&("string"==typeof s.read||(s.read||{})["#"])?s.read:null,f="string"==typeof s?s:s.write&&("string"==typeof s.write||s.write["#"])?s.write:null;if(!i&&!c)return console.log("No policy found");var p=JSON.stringify({c:t,...o?{e:o}:{},...i?{r:i}:{},...c?{w:c}:{},...u?{rb:u}:{},...f?{wb:f}:{}}),y=await l.sign(p,e,null,{raw:1});if(a.raw||(y="SEA"+JSON.stringify(y)),n)try{n(y)}catch(t){console.log(t)}return y}catch(t){if(l.err=t,l.throw)throw t;return void(n&&n())}}),t.exports=l.certify})(v,"./certify"),v(function(t){var o=v("./shim"),r=v("./root");r.work=v("./work"),r.sign=v("./sign"),r.verify=v("./verify"),r.encrypt=v("./encrypt"),r.decrypt=v("./decrypt"),r.certify=v("./certify"),r.random=r.random||o.random,r.Buffer=r.Buffer||v("./buffer"),r.keyid=r.keyid||(async t=>{try{var r=o.Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map(t=>o.Buffer.from(t,"base64"))),e=o.Buffer.concat([o.Buffer.from([153,r.length/256,r.length%256]),r]),n=await sha1hash(e);const a=o.Buffer.from(n,"binary");return a.toString("hex",a.length-8)}catch(t){throw console.log(t),t}}),((r.window||{}).Database||{}).Encryption=r,t.exports=r})(v,"./encryption"),v(function(t){var r,e=v("./encryption");function o(t){this._={$:this}}function n(){}function i(){return r.state().toString(36).replace(".","")}r=e.window?e.window.Database||{chain:{}}:v((void 0+""==typeof c?".":"")+"./database",1),e.Database=r,(o.prototype=(n.prototype=r.chain,new n)).constructor=o,r.chain.user=function(t){var r,n=this.back(-1);if(t)return t=e.opt.pub((t._||"")["#"])||t,n.get("~"+t);if(r=n.back("user"))return r;var t=n=n._,a=t.opt.uuid||i;return(t=(r=t.user=this.chain(new o))._).opt={},t.opt.uuid=function(t){var r=a(),e=n.user;return(e=e&&e.is)&&(e=e.pub)&&(r="~"+e+"/"+r,t&&t.call&&t(null,r)),r},r},(r.User=o).Database=r,o.Encryption=r.Encryption=e,t.exports=o})(v,"./user"),v(function(t){(""+void 0!=typeof window?window.Database||{chain:{}}:v((""+void 0==typeof c?".":"")+"./database",1)).chain.then=function(t,e){var n=this,r=new Promise(function(t,r){n.once(t,e)});return t?r.then(t):r}})(v,"./then"),v(function(t){var r=v("./user"),p=r.Encryption,y=r.Database,l=function(){};r.prototype.create=function(...t){var r,a="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,o=a&&(a.pub||a.epub)?a.pub:"string"==typeof t[0]?t[0]:null,i=a&&(a.pub||a.epub)?a:o&&"string"==typeof t[1]?t[1]:null,c=t.filter(t=>"function"==typeof t)[0]||null,e=t&&1<t.length&&"object"==typeof t[t.length-1]?t[t.length-1]:{},s=this,u=s._,n=s.back(-1),c=c||l,e=e||{};if(!1!==e.check&&(o||(r="No user."),r=(i||"").length<8?"Password too short":r))return c({err:y.log(r)}),s;if(u.ing)return(c||l)({err:y.log("User is already being created or authenticated"),wait:!0}),s;u.ing=!0;var f={a:function(t){if((f.pubs=t)&&!e.already){t={err:y.log("User already created")};return u.ing=!1,(c||l)(t),void s.leave()}f.salt=String.random(64),p.work(i,f.salt,f.b)},b:function(t){f.proof=t,a?f.c(a):p.pair(f.c)},c:function(t){var r;f.pair=t||{},(r=u.root.user)&&(r._.encryption=t,r.is={pub:t.pub,epub:t.epub,alias:o}),f.data={pub:t.pub},f.d()},d:function(){f.data.alias=o,f.e()},e:function(){f.data.epub=f.pair.epub,p.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},f.proof,f.f,{raw:1})},f:function(t){f.data.auth=JSON.stringify({ek:t,s:f.salt}),f.g(f.data.auth)},g:function(t){var r;f.data.auth=f.data.auth||t,n.get(r="~"+f.pair.pub).put(f.data).on(f.h);t={};t[r]={"#":r},n.get("~@"+o).put(t).get(r).on(f.i)},h:function(t,r,e,n){n.off(),f.h.ok=1,f.i()},i:function(t,r,e,n){n&&(f.i.ok=1,n.off()),f.h.ok&&f.i.ok&&(u.ing=!1,c({ok:0,pub:f.pair.pub}),l===c&&(a?s.auth(a):s.auth(o,i)))}};return n.get("~@"+o).once(f.a),s},r.prototype.leave=function(t,r){var e=this.back(-1)._.user;if(e&&(delete e.is,delete e._.is,delete e._.encryption),p.window)try{var n={};delete(n=window.sessionStorage).recall,delete n.pair}catch(t){}return this}})(v,"./create"),v(function(t){var r=v("./user"),h=r.Encryption,e=r.Database,w=function(){};function g(r){if("string"!=typeof r)return r;try{r=JSON.parse(r)}catch(t){r={}}return r}r.prototype.auth=function(...t){var r="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,o=r||"string"!=typeof t[0]?null:t[0],i=!o&&(!r||r.priv&&r.epriv)||"string"!=typeof t[1]?null:t[1],c=t.filter(t=>"function"==typeof t)[0]||null,s=t&&1<t.length&&"object"==typeof t[t.length-1]?t[t.length-1]:{},u=this,f=u._,p=u.back(-1);if(f.ing)return(c||w)({err:e.log("User is already being created or authenticated"),wait:!0}),u;f.ing=!0;var y,l={a:function(r){if(!r)return l.b();if(!r.pub){var e=[];return Object.keys(r).forEach(function(t){"_"!=t&&e.push(r[t])}),l.b(e)}if(l.name)return l.f(r);l.c((l.data=r).auth)},b:function(t){t=(l.list=(l.list||[]).concat(t||[])).shift();if(y===t)return l.name?l.err("User account is not published for dApps to access"):l.err("Wrong user or password");p.get(t).once(l.a)},c:function(t){return y===t?l.b():"string"==typeof t?l.c(g(t)):void h.work(i,(l.auth=t).s,l.d,l.enc)},d:function(t){h.decrypt(l.auth.ek,t,l.e,l.enc)},e:function(t){if(y===t)return l.enc?(l.enc=null,l.b()):(l.enc={encode:"utf8"},l.c(l.auth));l.half=t,l.f(l.data)},f:function(t){var r=l.half||{},e=l.data||{};l.g(l.lol={pub:t.pub||e.pub,epub:t.epub||e.epub,priv:t.priv||r.priv,epriv:t.epriv||r.epriv})},g:function(t){if(!t||!t.pub||!t.epub)return l.b();l.pair=t;var r=p._.user,e=r._,n=(e.tag,e.opt);(e=r._=p.get("~"+t.pub)._).opt=n,r.is={pub:t.pub,epub:t.epub,alias:o||t.pub},e.encryption=l.pair,f.ing=!1;try{i&&y==(g(f.root.graph["~"+t.pub].auth)||"")[":"]&&(s.shuffle=s.change=i)}catch(t){}if(s.change?l.z():(c||w)(e),h.window&&(u.back("user")._.opt||s).remember)try{var a={};(a=window.sessionStorage).recall=!0,a.pair=JSON.stringify(t)}catch(t){}try{p._.tag.auth?p._.on("auth",e):setTimeout(function(){p._.on("auth",e)},1)}catch(t){}},h:function(t){return t?(o=(o=t.alias)||(t.alias="~"+r.pub),t.auth?(r=null,void l.c((l.data=t).auth)):l.g(r)):l.b()},z:function(){l.salt=String.random(64),h.work(s.change,l.salt,l.y)},y:function(t){h.encrypt({priv:l.pair.priv,epriv:l.pair.epriv},t,l.x,{raw:1})},x:function(t){l.w(JSON.stringify({ek:t,s:l.salt}))},w:function(t){var r;s.shuffle&&(r={},Object.keys(l.data).forEach(function(t){r[t]=l.data[t]}),delete r._,r.auth=t,p.get("~"+l.pair.pub).put(r)),p.get("~"+l.pair.pub).get("auth").put(t,c||w)},err:function(t){t={err:e.log(t||"User cannot be found")};f.ing=!1,(c||w)(t)},plugin:function(t){if(!(l.name=t))return l.err();var r=[t];"~"!==t[0]&&(r[1]="~"+t,r[2]="~@"+t),l.b(r)}};return r?r.priv&&r.epriv?l.g(r):p.get("~"+r.pub).once(l.h):o?p.get("~@"+o).once(l.a):i||h.name(l.plugin),u}})(v,"./auth"),v(function(t){var r=v("./user"),a=r.Encryption;r.Database;r.prototype.recall=function(t,r){var e=this.back(-1);if((t=t||{})&&t.sessionStorage){if(a.window)try{var n={};(n=window.sessionStorage)&&(e._.opt.remember=!0,(this.back("user")._.opt||t).remember=!0,(n.recall||n.pair)&&e.user().auth(JSON.parse(n.pair),r))}catch(t){}return this}return this}})(v,"./recall"),v(function(t){var r=v("./user"),u=r.Encryption,e=r.Database;r.prototype.pair=function(){var t,n=this;try{t=new Proxy({DANGER:"☠"},{get:function(t,r,e){if(n.is&&(n._||"").encryption)return n._.encryption[r]}})}catch(t){}return t},r.prototype.delete=async function(t,r,e){this.back(-1);var n=this.back("user");try{n.auth(t,r,function(t){(n.is||{}).pub;n.map().once(function(){this.put(null)}),n.leave(),(e||function(){})({ok:0})})}catch(t){}return this},r.prototype.alive=async function(){var r=this.back(-1);try{return await authRecall(r),r._.user._}catch(t){r="No session!";throw e.log(r),{err:r}}},r.prototype.trust=async function(t){e.is(t)&&t.get("pub").get((t,r)=>{console.log(t,r)}),t.get("trust").get(path).put(theirPubkey)},r.prototype.grant=function(a,o){var i=this.back(-1).user(),c=i._.encryption,s="";return this.back(function(t){t.is||(s+=t.get||"")}),async function(){var t=await i.get("grant").get(c.pub).get(s).then();(t=await u.decrypt(t,c))||(t=u.random(16).toString(),n=await u.encrypt(t,c),i.get("grant").get(c.pub).get(s).put(n));var r=a.get("pub").then(),e=a.get("epub").then(),r=await r,e=await e,e=await u.secret(e,c),n=await u.encrypt(t,e);i.get("grant").get(r).get(s).put(n,o)}(),this},r.prototype.secret=function(e,n){var a=this,o=a.back(-1).user(),i=o.pair(),c="";return a.back(function(t){t.is||(c+=t.get||"")}),async function(){var t,r=await o.get("trust").get(i.pub).get(c).then();(r=await u.decrypt(r,i))||(r=u.random(16).toString(),t=await u.encrypt(r,i),o.get("trust").get(i.pub).get(c).put(t)),t=await u.encrypt(e,r),a.put(t,n)}(),a},t.exports=r})(v,"./share"),v(function(t){var h,w=v("./encryption"),g=v("./settings"),d=""+h!=typeof window?window.Database||{on:function(){}}:v((""+h==typeof c?".":"")+"./database",1);function p(r){var t,e,n=this,a=n.as,o=r.put,i=o["#"],c=o["."],s=o[":"],u=o[">"],f=r["#"];i&&c&&((r._||"").faith&&(a.opt||"").faith&&"function"==typeof r._?w.opt.pack(o,function(t){w.verify(t,!1,function(t){o["="]=w.opt.unpack(t),n.to.next(r)})}):(e=function(t){a.on("in",{"@":f,err:r.err=t})},(r._||"").DBG&&((r._||"").DBG.c=+new Date),0<=i.indexOf("<?")&&(t=parseFloat(i.split("<?")[1]||""))&&u<d.state()-1e3*t?(t=r._)&&t.stun&&t.stun--:"~@"!==i?"~@"!==i.slice(0,2)?(t=w.opt.pub(i))?p.pub(n,r,s,c,i,a,e,a.user||"",t):0<=i.indexOf("#")?p.hash(n,r,s,c,i,a,e):p.any(n,r,s,c,i,a,e,a.user||""):p.pubs(n,r,s,c,i,a,e):p.alias(n,r,s,c,i,a,e)))}d.on("opt",function(t){t.encryption||(t.encryption={own:{}},t.on("put",p,t)),this.to.next(t)}),p.hash=function(r,e,t,n,a,o,i){w.work(t,null,function(t){return t&&t===n.split("#").slice(-1)[0]?r.to.next(e):void i("Data hash not same as hash")},{name:"SHA-256"})},p.alias=function(t,r,e,n,a,o,i){return e?"~@"+n===b(e)?t.to.next(r):void i("Alias not same"):i("Data must exist")},p.pubs=function(t,r,e,n,a,o,i){return e?n===b(e)?t.to.next(r):void i("Alias not same"):i("Alias must exist")},p.pub=async function(i,c,e,s,u,n,f,a,p){var o;const y=await g.parse(e)||{},l=(t,a,o)=>{if(t.m&&t.s&&a&&p)return w.verify(t,p,r=>{if(h!==r&&h!==r.e&&c.put[">"]&&c.put[">"]>parseFloat(r.e))return f("Certificate expired.");if(h!==r&&r.c&&r.w&&(r.c===a||-1<r.c.indexOf("*"))){let t=-1<u.indexOf("/")?u.replace(u.substring(0,u.indexOf("/")+1),""):"";String.match=String.match||d.text.match;for(const n of Array.isArray(r.w)?r.w:"object"==typeof r.w||"string"==typeof r.w?[r.w]:[])if(String.match(t,n["#"])&&String.match(s,n["."])||!n["."]&&String.match(t,n["#"])||!n["#"]&&String.match(s,n["."])||String.match(t?t+"/"+s:s,n["#"]||n)){if(n["+"]&&-1<n["+"].indexOf("*")&&t&&-1==t.indexOf(a)&&-1==s.indexOf(a))return f(`Path "${t}" or key "${s}" must contain string "${a}"`);if(!r.wb||"string"!=typeof r.wb&&!(r.wb||{})["#"])return o(r);var e=i.as.root.$.back(-1);return(e="string"==typeof r.wb&&"~"!==r.wb.slice(0,1)?e.get("~"+p):e).get(r.wb).get(a).once(t=>!t||1!==t&&!0!==t?o(r):f(`Certificant ${a} blocked`))}return f("Certificate verification fail.")}})};if("pub"===s&&"~"+p===u)return e===p?i.to.next(c):f("Account not same");(o=a.is)&&o.pub&&!y["*"]&&!y["+"]&&(p===o.pub||p!==o.pub&&((c._.msg||{}).opt||{}).cert)?w.opt.pack(c.put,t=>{w.sign(t,a._.encryption,async function(t){if(h===t)return f(w.err||"Signature fail");if(c.put[":"]={":":o=w.opt.unpack(t.m),"~":t.s},c.put["="]=o,p===a.is.pub)return(o=b(e))&&((n.encryption.own[o]=n.encryption.own[o]||{})[p]=1),void JSON.stringifyAsync(c.put[":"],function(t,r){return t?f(t||"Stringify error"):(c.put[":"]=r,i.to.next(c))});if(p!==a.is.pub&&((c._.msg||{}).opt||{}).cert){const r=await g.parse(c._.msg.opt.cert);r&&r.m&&r.s&&l(r,a.is.pub,t=>{c.put[":"]["+"]=r,c.put[":"]["*"]=a.is.pub,JSON.stringifyAsync(c.put[":"],function(t,r){return t?f(t||"Stringify error"):(c.put[":"]=r,i.to.next(c))})})}},{raw:1})}):w.opt.pack(c.put,t=>{w.verify(t,y["*"]||p,function(r){var t;return r=w.opt.unpack(r),h===r?f("Unverified data"):((t=b(r))&&p===w.opt.pub(t)&&((n.encryption.own[t]=n.encryption.own[t]||{})[p]=1),y["+"]&&y["+"].m&&y["+"].s&&y["*"]?void l(y["+"],y["*"],t=>(c.put["="]=r,i.to.next(c))):(c.put["="]=r,i.to.next(c)))})})},p.any=function(r,t,e,n,a,o,i,c){if(o.opt.secure)return i("Soul missing public key at '"+n+"'");o.on("secure",function(t){return this.off(),o.opt.secure?void i("Data cannot be changed"):r.to.next(t)}).on.on("secure",t)};var e=d.valid,b=function(t,r){return"string"==typeof(r=e(t))&&r},r=((d.state||"").ify,/[^\w_-]/);w.opt.pub=function(t){if((t=t&&((t=t.split("~"))&&t[1]))&&(t=t.split(r).slice(0,2))&&2==t.length&&"@"!==(t[0]||"")[0])return t=t.slice(0,2).join(".")},w.opt.stringy=function(t){},w.opt.pack=function(n,a,o,i,c){var t,r;if(w.opt.check(n))return a(n);n&&n["#"]&&n["."]&&n[">"]&&(t=n[":"],r=1),JSON.parseAsync(r?t:n,function(t,r){var e=h!==(r||"")[":"]&&(r||"")["~"];a(e?{m:{"#":c||n["#"],".":o||n["."],":":(r||"")[":"],">":n[">"]||d.state.is(i,o)},s:e}:n)})};var a=w.opt;w.opt.unpack=function(t,r,e){if(h!==t){if(t&&h!==(n=t[":"]))return n;if(r=r||a.fall_key,!e&&a.fall_val&&((e={})[r]=a.fall_val),r&&e){if(t===e[r])return t;if(!w.opt.check(e[r]))return t;var n=e&&e._&&e._["#"]||a.fall_soul,e=d.state.is(e,r)||a.fall_state;return t&&4===t.length&&n===t[0]&&r===t[1]&&o(e)===o(t[3])?t[2]:e<w.opt.shuffle_attack?t:void 0}}},w.opt.shuffle_attack=15463296e5;var o=Math.floor})(v,"./index")}();